struct ThreadPool::Data
{
    using ProviderPtr = std::shared_ptr<ThreadPoolProvider>;

    Data ();
    Data (ThreadPoolProvider *p);
    ~Data ();
    Data (const Data&)            = delete;
    Data& operator= (const Data&) = delete;
    Data (Data&&)                 = default;
    Data& operator= (Data&&)      = delete;

    ProviderPtr getProvider () const { return std::atomic_load (&_provider); }

    void setProvider (ProviderPtr provider)
    {
        ProviderPtr curp = std::atomic_exchange (&_provider, provider);
        if (curp && curp != provider) curp->finish ();
    }

    std::shared_ptr<ThreadPoolProvider> _provider;
};
